<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:sans-serif;background:#f5f5f5;margin:0;padding:10px}
h2{text-align:center}
.controls{text-align:center;margin-bottom:10px}
select,input,button{padding:6px;font-size:16px;margin:4px}
table{border-collapse:collapse;width:100%;background:#fff}
th,td{border:1px solid #ccc;padding:4px;text-align:center;font-size:13px}
th{background:#eee;position:sticky;top:0}
.section{background:#dfefff;font-weight:bold}
.cell{cursor:pointer;font-weight:bold}
.today{outline:3px solid red}
.v1{background:#e3f2fd}.v2{background:#fce4ec}.v3{background:#e8f5e9}
.v4{background:#fff3e0}.v5{background:#ede7f6}.v6{background:#f3e5f5}
.v7{background:#e0f2f1}.v8{background:#fbe9e7}
#result{background:#fff;margin-top:10px;padding:10px;border-radius:6px}
</style>
</head>
<body>

<h2>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÄ‡∏ß‡∏£‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏µ)</h2>

<div class="controls">
  ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô <select id="month"></select>
  ‡∏õ‡∏µ (‡∏û.‡∏®.) <select id="year"></select><br>
  üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç‡πÄ‡∏ß‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ <input id="search" type="number" min="1" max="8" placeholder="1-8"><br>
  <button onclick="showToday()">‡∏î‡∏π‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
  <button onclick="resetAll()" style="background:#ffcccc">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏ß‡∏£‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏µ</button>
</div>

<table id="table"></table>
<div id="result"></div>

<script>
// ================= DATA =================
const council=[/* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏Ñ‡∏£‡∏ö */].concat([]);
// (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á)

// ================= SYSTEM =================
const monthSel=document.getElementById("month");
const yearSel=document.getElementById("year");
const table=document.getElementById("table");
const search=document.getElementById("search");
const result=document.getElementById("result");

const dayNames=["‡∏≠‡∏≤.","‡∏à.","‡∏≠.","‡∏û.","‡∏û‡∏§.","‡∏®.","‡∏™."];

["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°","‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå","‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°","‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô","‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°","‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
"‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°","‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°","‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô","‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°","‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô","‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"]
.forEach((m,i)=>monthSel.innerHTML+=`<option value="${i}">${m}</option>`);

for(let y=2567;y<=2575;y++) yearSel.innerHTML+=`<option>${y}</option>`;
monthSel.value=new Date().getMonth();
yearSel.value=new Date().getFullYear()+543;

function getLast(){return JSON.parse(localStorage.getItem("last-duty")||"{}");}
function saveLast(d){localStorage.setItem("last-duty",JSON.stringify(d));}
function key(){return `month-${monthSel.value}-${yearSel.value}`;}
function load(){return JSON.parse(localStorage.getItem(key())||"{}");}
function save(d){localStorage.setItem(key(),JSON.stringify(d));}

// ================= RENDER =================
function render(){
 table.innerHTML="";
 const y=yearSel.value-543,m=+monthSel.value;
 let days=[];
 for(let d=1;d<=new Date(y,m+1,0).getDate();d++){
   let wd=new Date(y,m,d).getDay();
   if(wd!=0 && wd!=6) days.push({day:d,wd});
 }

 let h="<tr><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏´‡πâ‡∏≠‡∏á</th>";
 days.forEach(d=>h+=`<th>${dayNames[d.wd]}<br>${d.day}</th>`);
 h+="</tr>";
 table.innerHTML+=h;

 addSection("‡∏™‡∏†‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô",council,days);
 find();
}

function addSection(title,list,days){
 table.innerHTML+=`<tr class="section"><td colspan="${days.length+2}">${title}</td></tr>`;
 let monthData=load(), last=getLast();
 list.forEach((s,i)=>{
   let start=(last[s.name]||0)%8+1;
   let r=`<tr><td>${i+1}. ${s.name}</td><td>${s.room}</td>`;
   days.forEach((d,j)=>{
     let v=monthData[`${s.name}-${j}`]||((start+j-1)%8+1);
     r+=`<td class="cell v${v}" onclick="edit(this,'${s.name}',${j})">${v}</td>`;
   });
   r+="</tr>";
   table.innerHTML+=r;
 });
}

// ================= EDIT =================
function edit(td,name,startIndex){
 let v=parseInt(prompt("‡πÄ‡∏•‡∏Ç‡πÄ‡∏ß‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (1-8)",td.innerText));
 if(!v||v<1||v>8) return;

 let cells=[...td.parentElement.querySelectorAll(".cell")];
 let idx=cells.indexOf(td);
 let data=load(), last=getLast();

 for(let i=idx;i<cells.length;i++){
   cells[i].innerText=v;
   cells[i].className="cell v"+v;
   data[`${name}-${i}`]=v;
   v=v%8+1;
 }

 last[name]=v===1?8:v-1;
 saveLast(last); save(data); find();
}

// ================= üîç SEARCH (TODAY ONLY) =================
function find(){
 result.innerHTML="";
 let n=+search.value;
 if(!n) return;

 const today=new Date().getDate();
 let colIndex=-1;

 [...table.rows[0].cells].forEach((th,i)=>{
   if(th.innerText.includes(today)) colIndex=i;
 });

 if(colIndex===-1){
   result.innerHTML="‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ß‡∏£ (‡πÄ‡∏™‡∏≤‡∏£‡πå‚Äì‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå)";
   return;
 }

 let out=[];
 [...table.rows].forEach((r,ri)=>{
   if(ri===0) return;
   let cell=r.cells[colIndex];
   if(cell && +cell.innerText===n){
     out.push(`${r.cells[0].innerText} (${r.cells[1].innerText})`);
   }
 });

 result.innerHTML=
   `<b>‡πÄ‡∏ß‡∏£‡πÄ‡∏•‡∏Ç ${n} (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)</b><br>`+
   (out.length?out.join("<br>"):"‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏£");
}

// ================= TODAY / RESET =================
function showToday(){
 document.querySelectorAll(".today").forEach(c=>c.classList.remove("today"));
 let d=new Date().getDate();
 [...table.rows[0].cells].forEach((th,i)=>{
   if(th.innerText.includes(d)){
     [...table.rows].forEach((r,ri)=>{
       if(ri>0 && r.cells[i]) r.cells[i].classList.add("today");
     });
   }
 });
}

function resetAll(){
 if(!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏ß‡∏£‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏µ?")) return;
 localStorage.clear();
 render();
 alert("‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
}

monthSel.onchange=yearSel.onchange=render;
search.oninput=find;
render();
</script>
</body>
</html>

